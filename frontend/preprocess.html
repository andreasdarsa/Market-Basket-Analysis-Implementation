<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Market Basket Analyzer - Preprocess File</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="styles.css" rel="stylesheet">
    </head>
    <body>
         <!-- Navbar -->
         <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <a class="navbar-brand" href="home.html">MBA App</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item" id="toHome">
                            <a class="nav-link" aria-current="page" href="home.html">Home</a>
                        </li>
                        <li class="nav-item" id="upload-link">
                            <a class="nav-link" href="upload.html">Upload CSV</a>
                        </li>
                        <li class="nav-item" id="toPreprocess">
                            <a class="nav-link active fw-bold text-primary" aria-current="page" href="preprocess.html">Preprocess file</a>
                        </li>
                        <li class="nav-item" id="toAnalysis">
                            <a class="nav-link" href="analysis.html">Analysis</a>
                        </li>
                        <li class="nav-item" id="toVisuals">
                            <a class="nav-link" href="visuals.html">Visuals</a>
                        </li>
                        <li class="nav-item" id="toAbout">
                            <a class="nav-link" href="/about">About</a>
                        </li>
                     </ul>
                </div>
            </div>
        </nav>

        <section class="container mt-5" id="preprocess-instructions">
            <h3>Preprocessing Instructions</h3>
            <p>To preprocess your CSV file, please provide the following details:</p>
            <ul>
                <li><strong>TransactionID Column:</strong> The name of the column that contains unique transaction identifiers.</li>
                <li><strong>Items Column:</strong> The name of the column that contains the items purchased in each transaction.</li>
            </ul>
            <p>After submitting the form, the application will clean and prepare your data for analysis using the Apriori algorithm.</p>
            <p>If you encounter any issues, please ensure that your CSV file is correctly formatted as per the instructions on the <a href="/upload">Upload</a> page.</p>
        </section> 
        
        <!-- File Info -->
        <section class="container mt-5">
            <div id="upload-status" class="card">
                <div class="card-body">
                    <h5 class="card-title">CSV Upload Status</h5>
                    <div id="file-info">
                        <p>No file uploaded yet.</p>
                    </div>
                </div>
            </div>
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                const fileInfoDiv = document.getElementById('file-info');

                // Αν χρησιμοποιούμε fetch για να πάρουμε info από backend
                fetch('/csv_info')
                    .then(res => res.json())
                    .then(fileInfo => {
                        if (fileInfo && fileInfo.fileName && typeof fileInfo.transactionCount === 'number') {
                            fileInfoDiv.innerHTML = `
                                <p><strong>File Name:</strong> ${fileInfo.fileName}</p>
                                <p><strong>Number of Transactions:</strong> ${fileInfo.transactionCount}</p>
                            `;
                        } else {
                            fileInfoDiv.innerHTML = `<p>No file uploaded yet.</p>`;
                        }
                    });
                });
            </script>
        </section>

        <!-- Preprocessing steps -->
        <section class="container mt-5">
            <h3>Preprocessing Steps</h3>
            <p>The preprocessing will include the following steps:</p>
            <ul>
                <li>Checking for the necessary columns</li>
                <li>Splitting product columns</li>
                <li>Deleting very small transactions</li>
                <li>Deleting rare products</li>
            </ul>
        </section>

        <!-- Cleaned CSV head (10 lines)-->
        <section class="container mt-5">
            <h3>Preview of Cleaned Data</h3>
            <div id="cleaned-data-preview" class="table-responsive">
                <p>No cleaned data available. Please preprocess a file first.</p>
            </div>
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const previewDiv = document.getElementById('cleaned-data-preview');

                    // Αν χρησιμοποιούμε fetch για να πάρουμε το preview από backend
                    fetch('/cleaned_data_preview')
                        .then(res => res.json())
                        .then(data => {
                            if (data && data.length > 0) {
                                let tableHTML = '<table class="table table-striped"><thead><tr>';
                                // Headers
                                Object.keys(data[0]).forEach(header => {
                                    tableHTML += `<th>${header}</th>`;
                                });
                                tableHTML += '</tr></thead><tbody>';
                                // Rows
                                data.forEach(row => {
                                    tableHTML += '<tr>';
                                    Object.values(row).forEach(value => {
                                        tableHTML += `<td>${value}</td>`;
                                    });
                                    tableHTML += '</tr>';
                                });
                                tableHTML += '</tbody></table>';
                                previewDiv.innerHTML = tableHTML;
                            } else {
                                previewDiv.innerHTML = '<p>No cleaned data available. Please preprocess a file first.</p>';
                            }
                        });
                });
            </script>
        </section>

        <!-- Summary (stats etc.)-->
        <section class="container mt-5">
            <h3>Data Summary</h3>
            <div id="data-summary">
                <p>No summary available. Please preprocess a file first.</p>
            </div>
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const summaryDiv = document.getElementById('data-summary');

                    // Αν χρησιμοποιούμε fetch για να πάρουμε το summary από backend
                    fetch('/data_summary')
                        .then(res => res.json())
                        .then(summary => {
                            if (summary) {
                                let summaryHTML = '<ul>';
                                for (const [key, value] of Object.entries(summary)) {
                                    summaryHTML += `<li><strong>${key}:</strong> ${value}</li>`;
                                }
                                summaryHTML += '</ul>';
                                summaryDiv.innerHTML = summaryHTML;
                            } else {
                                summaryDiv.innerHTML = '<p>No summary available. Please preprocess a file first.</p>';
                            }
                        });
                });
            </script>
        </section>
    </body>
    <script href="preprocess.js"></script>
</html>